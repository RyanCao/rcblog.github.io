<!DOCTYPE html><html lang="zh-CN" mip><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Docker-compose 学习_Devlopper in C#</title><meta name="description" content="Docker-compose 学习 - Chester.C"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://c.mipcdn.com/static/v1/mip.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.rcant.com/atom.xml" title="Chester.Cao Blog"><link rel="canonical" href="http://blog.rcant.com/2017/05/18/docker/docker-compose-first/"/><style mip-custom>a,abbr,acronym,address,applet,big,blockquote,body,caption,cite,code,dd,del,dfn,div,dl,dt,em,fieldset,form,h1,h2,h3,h4,h5,h6,html,iframe,img,ins,kbd,label,legend,li,object,ol,p,pre,q,s,samp,small,span,strike,strong,sub,sup,table,tbody,td,tfoot,th,thead,tr,tt,ul,var{margin:0;padding:0;border:0;font-family:inherit;font-size:100%;font-weight:inherit;font-style:inherit;vertical-align:baseline;outline:0}body{line-height:1;color:#000;background:#fff}ol,ul{list-style:none}table{vertical-align:middle;border-spacing:0;border-collapse:separate}caption,td,th{font-weight:400;text-align:left;vertical-align:middle}a img{border:none}html{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}*,:after,:before{-webkit-box-sizing:inherit;-moz-box-sizing:inherit;box-sizing:inherit}button::-moz-focus-inner,input[type=button]::-moz-focus-inner,input[type=reset]::-moz-focus-inner,input[type=submit]::-moz-focus-inner{margin:0;padding:0;border:0}button,input,select{margin:0;padding:0;border:0}body{overflow-x:hidden;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:15px;color:#444;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility}.mip-nav-wrapper{padding:0 10px;background-color:#323436}.navbar-brand{color:#fff!important}@media screen and (min-width:767px){.mip-nav-wrapper a{color:#fff!important}}@media screen and (max-width:767px){.mip-nav-wrapper .navbar-brand{margin-top:2px}}.navbar-brand{display:block;overflow:hidden;max-width:200px;line-height:41px;white-space:nowrap;text-overflow:ellipsis}mip-fixed[type=bottom],mip-fixed[type=top]{overflow:visible}.post{position:relative;padding:15px 10px;border-top:1px solid #fff;border-bottom:1px solid #ddd;word-wrap:break-word;background-color:#fff}h1.title,h2.title{padding:10px 0;font-size:28px}.post .meta{color:#666}.article-more a{color:#2479c2}.article-content .date{display:inline-block;margin:0 10px;font-size:14px;font-style:italic;color:#999}.article-content{line-height:1.6em;color:#444}@media print{.article-content{font-size:12pt}}.article-content .highlight,.article-content blockquote,.article-content dl,.article-content iframe,.article-content ol,.article-content p,.article-content table,.article-content ul{margin:1em 0}.article-content h1{font-size:2em}.article-content h2{font-size:1.5em}.article-content h3{font-size:1.3em}.article-content h1,.article-content h2,.article-content h3,.article-content h4,.article-content h5,.article-content h6{margin:1em 0;font-weight:700;line-height:1em}.article-content a{text-decoration:none;color:#0e83cd}.article-content a:hover{text-decoration:underline;color:#1094e8}@media print{.article-content a{text-decoration:underline;color:#444}.article-content a:after{content:" (" attr(href) ")";font-size:80%}}.article-content strong{font-weight:700}.article-content em{font-style:italic}.article-content dl,.article-content ol,.article-content ul{margin-left:20px}.article-content dl dl,.article-content dl ol,.article-content dl ul,.article-content ol dl,.article-content ol ol,.article-content ol ul,.article-content ul dl,.article-content ul ol,.article-content ul ul{margin-top:0;margin-bottom:0}.article-content ul{list-style:disc}.article-content ol{list-style:decimal}.article-content dl{list-style:square}.article-content li p{margin:0}.article-content li .highlight,.article-content li blockquote,.article-content li iframe,.article-content li table{margin:1em 0}.article-content img,.article-content video{max-width:100%}.article-content table{max-width:100%;border:1px solid #e3e3e3}.article-content table th{font-weight:700}.article-content table td,.article-content table th{padding:5px 15px}.article-content table tr:nth-child(2n){background:#eee}.article-content blockquote{position:relative;padding:0 20px;border:1px solid #e3e3e3;border-left:5px solid #ddd}.article-content .tip,.article-content .tip-error,.article-content .tip-info{position:relative;margin:1em 0;padding:1em 20px;border:1px solid #e3e3e3;border-left:5px solid #5fb878;border-top-right-radius:2px;border-bottom-right-radius:2px}.article-content .tip br:first-child,.article-content .tip-error br:first-child,.article-content .tip-info br:first-child{display:none}.article-content .tip-error:before,.article-content .tip-info:before{content:"!";position:absolute;top:16px;left:-12px;width:20px;height:20px;font-family:Dosis,"Source Sans Pro","Helvetica Neue",Arial,sans-serif;font-size:14px;font-weight:700;line-height:20px;text-align:center;color:#fff;border-radius:100%;background-color:#5fb878}.article-content .tip-info{border-left-color:#1e9fff}.article-content .tip-info:before{background-color:#1e9fff}.article-content .tip-error{border-left-color:#ff5722}.article-content .tip-error:before{background-color:#ff5722}.main{padding:72px 10px 0;max-width:1000px;margin:0 auto}@media screen and (max-width:767px){.main{padding-top:44px}}code,pre{font-family:"Source Code Pro",Monaco,Menlo,Consolas,monospace;font-size:.95em;color:#4d4d4c;background:#eee;overflow-x:auto;-webkit-overflow-scrolling:touch}code{padding:0 5px}pre{padding:10px 15px;line-height:22px}pre code{display:block;padding:0;border:none}.highlight{overflow:auto;margin:0;padding:10px 15px;color:#4d4d4c;background:#eee}.highlight table{margin:0!important;border:0}.highlight table td,.highlight table th{padding:0}.highlight figcaption{margin:-5px 0 5px;font-size:.9em;color:#999}.highlight figcaption:after,.highlight figcaption:before{content:"";display:table}.highlight figcaption:after{clear:both}.highlight figcaption a{float:right}.highlight pre{padding:0;border:none;background:0 0}.highlight .line{height:22px}pre .comment,pre .title{color:#8e908c}pre .attribute,pre .css .class,pre .css .id,pre .css .pseudo,pre .html .doctype,pre .regexp,pre .ruby .constant,pre .tag,pre .variable,pre .xml .doctype,pre .xml .pi,pre .xml .tag .title{color:#c82829}pre .built_in,pre .constant,pre .literal,pre .number,pre .params,pre .preprocessor{color:#f5871f}pre .class,pre .css .rules .attribute,pre .ruby .class .title{color:#718c00}pre .header,pre .inheritance,pre .ruby .symbol,pre .string,pre .value,pre .xml .cdata{color:#718c00}pre .css .hexcolor{color:#3e999f}pre .coffeescript .title,pre .function,pre .javascript .title,pre .perl .sub,pre .python .decorator,pre .python .title,pre .ruby .function .title,pre .ruby .title .keyword{color:#4271ae}pre .javascript .function,pre .keyword{color:#8959a8}.footer{line-height:1.8;text-align:center;padding:15px;border-top:1px solid #fff;font-size:.9em;color:#999}.footer a{color:#2479c2}.pagination{width:100%;line-height:20px;position:relative;border-top:1px solid #fff;border-bottom:1px solid #ddd;padding:20px 0;overflow:hidden}.pagination .prev{float:left}.pagination .next{float:right}.pagination a{color:#2479c2}</style><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="Chester.Cao Blog" type="application/atom+xml">
</head><body><mip-fixed type="top"><div class="mip-nav-wrapper"><mip-nav-slidedown data-id="bs-navbar" data-showbrand="1" data-brandname="Chester.C" data-brandhref="/" class="mip-element-sidebar container"><nav id="bs-navbar" class="navbar-collapse collapse navbar navbar-static-top"><ul class="nav navbar-nav navbar-right"><li><a data-type="mip" href="/">Home</a></li><li><a data-type="mip" href="/archives/">Archive</a></li><li><a data-type="mip" href="/categories/">menu.Categories</a></li><li><a data-type="mip" href="/tags/">menu.Tags</a></li><li class="navbar-wise-close"><span id="navbar-wise-close-btn"></span></li></ul></nav></mip-nav-slidedown></div></mip-fixed><div class="main"><div class="post-detail"><article class="post"><h1 class="title">Docker-compose 学习</h1><div class="meta">2017年5月18日</div><div class="article-content"><h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><p>Docker-Compose 属于Docker的一个工具</p>
<a href="#" id="more"></a>


<h2 id="Docker-compose-安装"><a href="#Docker-compose-安装" class="headerlink" title="Docker-compose 安装"></a>Docker-compose 安装</h2><p>安装它的前提是要安装pip工具.</p>
<p>首先检查Linux有没有安装Python-pip包</p>
<p>直接执行 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y python-pip</span><br></pre></td></tr></table></figure>

<p>没有python-pip包就执行命令 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y epel-release</span><br></pre></td></tr></table></figure>

<p>执行成功之后，再次执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y python-pip</span><br></pre></td></tr></table></figure>

<p>对安装好的pip进行升级 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade pip </span><br><span class="line"></span><br><span class="line">使用镜像</span><br></pre></td></tr></table></figure>
<p>pip install –upgrade pip -i <a target="_blank" rel="noopener" href="http://pypi.douban.com/simple">http://pypi.douban.com/simple</a> –trusted-host pypi.douban.com</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">最后安装</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>pip install docker-compose</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">使用镜像</span><br></pre></td></tr></table></figure>
<p>pip install docker-compose -i <a target="_blank" rel="noopener" href="http://pypi.douban.com/simple">http://pypi.douban.com/simple</a> –trusted-host pypi.douban.com</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## Docker-compose 学习</span><br><span class="line"></span><br><span class="line">一个使用Docker容器的应用，通常由多个容器组成。使用Docker Compose，不再需要使用shell脚本来启动容器。在配置文件中，所有的容器通过services来定义，然后使用docker-compose脚本来启动，停止和重启应用，和应用中的服务以及所有依赖服务的容器。完整的命令列表如下：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>build 构建或重建服务<br>help 命令帮助<br>kill 杀掉容器<br>logs 显示容器的输出内容<br>port 打印绑定的开放端口<br>ps 显示容器<br>pull 拉取服务镜像<br>restart 重启服务<br>rm 删除停止的容器<br>run 运行一个一次性命令<br>scale 设置服务的容器数目<br>start 开启服务<br>stop 停止服务<br>up 创建并启动容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[参考](https:&#x2F;&#x2F;docs.docker.com&#x2F;compose&#x2F;install&#x2F; ) 。你能运行Compose在OSX和64位Linux。当前不支持Windows操作系统。</span><br><span class="line"></span><br><span class="line">## 配置文件 docker-compose.yml</span><br><span class="line"></span><br><span class="line">Compose 文件是一个 YAML , 主要定义了 services , networks 和 volumes ， 其默认路径是 .&#x2F;docker-compose.yml 。</span><br><span class="line"></span><br><span class="line">service 定义包含了应用与每个容器的配置，很像给 docker run 传参，同样， network 和 volume 对于 docker network create 和 docker volume create 也类似。</span><br><span class="line"></span><br><span class="line">像在 Dockerfile (eg: CMD , EXPOSE , VOLUME , ENV )可以使用的选项也可以在 docker run 参数中使用， 这样在 docker-compose.yml 里就不需要再次指定了。</span><br><span class="line"></span><br><span class="line">docker-compose.yml 里可以使用环境变量，类似 Bash 格式 $&#123;VARIABLE&#125;</span><br><span class="line"></span><br><span class="line">参考</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>version: ‘2’<br>services:<br>  web:<br>    image: dockercloud/hello-world<br>    ports:<br>      - 8080<br>    networks:<br>      - front-tier<br>      - back-tier</p>
<p>  redis:<br>    image: redis<br>    links:<br>      - web<br>    networks:<br>      - back-tier</p>
<p>  lb:<br>    image: dockercloud/haproxy<br>    ports:<br>      - 80:80<br>    links:<br>      - web<br>    networks:<br>      - front-tier<br>      - back-tier<br>    volumes:<br>      - /var/run/docker.sock:/var/run/docker.sock </p>
<p>networks:<br>  front-tier:<br>    driver: bridge<br>  back-tier:<br>driver: bridge</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### Composer Version </span><br><span class="line">composer 文件格式有两种版本：</span><br><span class="line"></span><br><span class="line">- version 1: 已经废弃， </span><br><span class="line">- version 2: 推荐的格式，目前是最新的，需要通过 version &#39;2&#39; 指定。</span><br><span class="line"></span><br><span class="line">### Service配置</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>services:<br>  web:<br>    image: hello-world</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### build</span><br><span class="line"></span><br><span class="line">指定 Dockerfile 所在文件夹的路径。 Compose 将会利用它自动构建这个镜像，然后使用这个镜像。</span><br></pre></td></tr></table></figure>
<p>build: /path/to/build/dir</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### command</span><br><span class="line"></span><br><span class="line">覆盖容器启动后默认执行的命令。</span><br></pre></td></tr></table></figure>
<p>command: bundle exec thin -p 3000</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### links</span><br><span class="line"></span><br><span class="line">链接到其它服务中的容器。使用服务名称（同时作为别名）或服务名称：服务别名 （SERVICE:ALIAS） 格式都可以。</span><br></pre></td></tr></table></figure>
<p>links:</p>
<ul>
<li>db</li>
<li>db:database</li>
<li>redis<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">使用的别名将会自动在服务容器中的 &#x2F;etc&#x2F;hosts 里创建。例如：</span><br><span class="line">172.17.2.186 db</span><br><span class="line">相应的环境变量也将被创建。</span><br><span class="line"></span><br><span class="line">#### external_links</span><br><span class="line"></span><br><span class="line">链接到 docker-compose.yml 外部的容器，甚至 并非 Compose 管理的容器。参数格式跟 links 类似。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
external_links:</li>
<li>redis_1</li>
<li>project_db_1:mysql</li>
<li>project_db_1:postgresql<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### ports</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>“3000”</li>
<li>“8000:8000”</li>
<li>“127.0.0.1:8001:8001”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">注：当使用 HOST:CONTAINER 格式来映射端口时，如果你使用的容器端口小于 60 你可能会得到错误得结果，因为 YAML 将会解析 xx:yy 这种数字格式为 60 进制。所以建议采用字符串格式。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### expose</span><br><span class="line"></span><br><span class="line">暴露端口，但不映射到宿主机，只被连接的服务访问。</span><br><span class="line">仅可以指定内部端口为参数</span><br></pre></td></tr></table></figure>
expose:</li>
<li>“3000”</li>
<li>“8000”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### volumes</span><br><span class="line"></span><br><span class="line">卷挂载路径设置。可以设置宿主机路径 （HOST:CONTAINER） 或加上访问模式 （HOST:CONTAINER:ro）。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
volumes:</li>
<li>/var/lib/mysql</li>
<li>cache/:/tmp/cache</li>
<li>~/configs:/etc/configs/:ro<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### volumes</span><br><span class="line"></span><br><span class="line">从另一个服务或容器挂载它的所有卷。</span><br></pre></td></tr></table></figure>
volumes_from:</li>
<li>service_name</li>
<li>container_name<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### environment</span><br><span class="line"></span><br><span class="line">设置环境变量。你可以使用数组或字典两种格式。</span><br><span class="line">只给定名称的变量会自动获取它在 Compose 主机上的值，可以用来防止泄露不必要的数据。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
environment:</li>
<li>RACK_ENV=development</li>
<li>SESSION_SECRET<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### env_file</span><br><span class="line"></span><br><span class="line">从文件中获取环境变量，可以为单独的文件路径或列表。</span><br><span class="line">如果通过 docker-compose -f FILE 指定了模板文件，则 env_file 中路径会基于模板文件路径。</span><br><span class="line">如果有变量名称与 environment 指令冲突，则以后者为准。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
env_file: .env<br>env_file:</li>
<li>./common.env</li>
<li>./apps/web.env</li>
<li>/opt/secrets.env<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">环境变量文件中每一行必须符合格式，支持 # 开头的注释行。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="common-env-Set-Rails-Rack-environment"><a href="#common-env-Set-Rails-Rack-environment" class="headerlink" title="common.env: Set Rails/Rack environment"></a>common.env: Set Rails/Rack environment</h1>RACK_ENV=development<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### extends</span><br><span class="line"></span><br><span class="line">基于已有的服务进行扩展。例如我们已经有了一个 webapp 服务，模板文件为 common.yml。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="common-yml"><a href="#common-yml" class="headerlink" title="common.yml"></a>common.yml</h1>webapp:<br>build: ./webapp<br>environment:<br>\ - DEBUG=false<br>\ - SEND_EMAILS=false<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">编写一个新的 development.yml 文件，使用 common.yml 中的 webapp 服务进行扩展。</span><br><span class="line"></span><br><span class="line">development.yml </span><br><span class="line"></span><br></pre></td></tr></table></figure>
web:<br>extends:<br>file: common.yml<br>service: webapp<br>ports:<br>\ - “8000:8000”<br>links:<br>\ - db<br>environment:</li>
<li>DEBUG=true<br>db:<br>image: postgres<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">后者会自动继承 common.yml 中的 webapp 服务及相关环节变量。</span><br><span class="line"></span><br><span class="line">#### net</span><br><span class="line"></span><br><span class="line">设置网络模式。使用和 docker client 的 --net 参数一样的值。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
net: “bridge”<br>net: “none”<br>net: “container:[name or id]”<br>net: “host”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### pid</span><br><span class="line"></span><br><span class="line">跟主机系统共享进程命名空间。打开该选项的容器可以相互通过进程 ID 来访问和操作。</span><br></pre></td></tr></table></figure>
pid: “host”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### dns</span><br><span class="line"></span><br><span class="line">配置 DNS 服务器。可以是一个值，也可以是一个列表。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
dns: 8.8.8.8<br>dns:</li>
<li>8.8.8.8</li>
<li>9.9.9.9<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### cap_add, cap_drop</span><br><span class="line"></span><br><span class="line">添加或放弃容器的 Linux 能力（Capabiliity）。</span><br></pre></td></tr></table></figure>
cap_add:</li>
<li>ALL<br>cap_drop:</li>
<li>NET_ADMIN</li>
<li>SYS_ADMIN<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### dns_search</span><br><span class="line"></span><br><span class="line">配置 DNS 搜索域。可以是一个值，也可以是一个列表。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
dns_search: example.com<br>dns_search:</li>
<li>domain1.example.com<br>\ - domain2.example.com</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 更多</span><br><span class="line"></span><br><span class="line">working_dir, entrypoint, user, hostname, domainname, mem_limit, privileged, restart, stdin_open, tty, cpu_shares</span><br><span class="line"></span><br><span class="line">这些都是和 docker run 支持的选项类似。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>cpu_shares: 73<br>working_dir: /code<br>entrypoint: /code/entrypoint.sh<br>user: postgresql<br>hostname: foo<br>domainname: foo.com<br>mem_limit: 1000000000<br>privileged: true<br>restart: always<br>stdin_open: true<br>tty: true</p>
<pre><code></code></pre>
</div></article></div><div class="pagination"><a data-type="mip" href="/2017/05/19/docker/docker-volume/" class="prev"><< Prev</a><a data-type="mip" href="/2017/05/18/docker/docker-first/" class="next">Next >></a></div></div><div class="footer"><p>© 2017 - 2020 <a data-type="mip" href="http://blog.rcant.com">Chester.C</a> , powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/xuexb/hexo-theme-mip/" target="_blank">hexo-theme-mip</a>.</p></div><mip-fixed type="gototop"><mip-gototop></mip-gototop></mip-fixed><script src="https://c.mipcdn.com/static/v1/mip.js"></script><script src="https://c.mipcdn.com/static/v1/mip-nav-slidedown/mip-nav-slidedown.js"></script><script src="https://c.mipcdn.com/static/v1/mip-gototop/mip-gototop.js"></script><script src="https://c.mipcdn.com/static/v1/mip-fixed/mip-fixed.js"></script></body></html>